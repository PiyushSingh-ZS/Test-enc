name: Build and Deploy

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  debug-secrets:
    runs-on: ubuntu-latest

    steps:
      - name: Write secrets to JSON file
        env:
          SVC_PRI_USERNAME: ${{ secrets.SVC_PRI_USERNAME }}
          SVC_PRI_PASSWORD: ${{ secrets.SVC_PRI_PASSWORD }}
          AZURE_CREDENTIALS: ${{ secrets.AZURE_CREDENTIALS }}
        run: |
          cat <<EOF > secrets.json
{
  "SVC_PRI_USERNAME": "$SVC_PRI_USERNAME",
  "SVC_PRI_PASSWORD": "$SVC_PRI_PASSWORD",
  "AZURE_CREDENTIALS": $AZURE_CREDENTIALS
}
EOF
          echo "Secrets written to secrets.json"

      # Optional: Show structure only (GitHub may still mask!)
      - name: Show file structure (partial visibility)
        run: |
          jq 'keys' secrets.json

      # âœ… Best: Upload as artifact and download securely
      - name: Upload secret file as artifact
        uses: actions/upload-artifact@v4
        with:
          name: full-secrets
          path: secrets.json
